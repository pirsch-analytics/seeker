{{define "tree-node"}}
    {{$page := .page}}
    {{range .children}}
        {{$hasChildren := (gt (len .Pages) 0)}}

        <li class="menu-node {{if eq $page .}}active{{end}}">
            {{if .IsSection}}
                <span class="section">
                    <i class="open">O</i>
                    <i class="close hidden">C</i>
                    {{.Title}}
                </span>
            {{else}}
                <a href="{{.RelPermalink}}">{{.Title}}</a>
            {{end}}

            {{if $hasChildren}}
                <ul class="{{if .IsSection}}hidden{{end}}">
                    {{template "tree-node" dict "children" .Pages "page" $page}}
                </ul>
            {{end}}
        </li>
    {{end}}
{{end}}

<div class="menu">
    <ul>
        {{template "tree-node" dict "children" .Site.Home.Sections "page" .}}
    </ul>
</div>
